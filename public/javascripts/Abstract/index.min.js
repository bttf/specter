$(function(){function x(){var e=$("#editArea");return e.autosize(),e}function T(e){$(e.join(",")).hide()}function N(e){$(e.join(",")).show()}function C(){return B.val()}function k(e){return e.split(/\s+\b/).length}function L(e){m.text("words: "+k(e));var t=marked(e);a.html(t)}function A(){a.text(a.html())}function O(){a.html(a.text())}function M(e){return e.match(/\d+/)[0]}function _(){var e=l.val().trim()==="",t=s.val()==="",n=!e&&!t;return n}function D(){var e=a.html(),t={postHtml:e,wordCount:M(m.text()),title:l.val(),secret:g.val(),tags:b.val().split(",")};return t}function P(){$.post("/addpost",D(),function(e){z(l.val()),window.location.href="/"+e.id}).fail(function(e){e.status===403&&alert("un-authorized"),e.status===500&&alert("internal server error")})}function H(){var e=D();e.postedBy=y.data().postedby,e.id=y.data().id,e.postedOn=y.data().postedon,$.post("/updatePost",e,function(t){z(e.title),window.location.href="/"+t.id}).fail(function(e){e.status===403&&alert("un-authorized"),e.status===500&&alert("internal server error")})}function j(){return Object.keys(localStorage)}function F(e){return e.sort(function(e,t){return e=new Date(e.trueDate),t=new Date(t.trueDate),e<t?-1:e>t?1:0}).reverse()}function I(e){var t=[];for(var n=0;n<e.length;n++){var r=JSON.parse(localStorage[e[n]]),i=new w(r,e[n]);t.push(i)}return F(t)}function q(){var e=I(j());S.drafts(e)}function R(e){var t=l.val();localStorage.hasOwnProperty(e)&&z(e);var n={};n.time=new Date,n.text=C(),n.wordCount=M(m.text()),n.tags=b.val(),localStorage.setItem(t,JSON.stringify(n))}function U(e){return localStorage.getItem(e)}function z(e){localStorage.removeItem(e)}(function(e){var t={className:"autosizejs",append:"",callback:!1},n="hidden",r="border-box",i="lineHeight",s,o='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>',u=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],a="oninput",f="onpropertychange",l,c=e(o).data("autosize",!0)[0];c.style.lineHeight="99px",e(c).css(i)==="99px"&&u.push(i),c.style.lineHeight="",e.fn.autosize=function(i){return i=e.extend({},t,i||{}),c.parentNode!==document.body&&(e(document.body).append(c),c.value="\n\n\n",c.scrollTop=9e4,s=c.scrollHeight===c.scrollTop+c.clientHeight),this.each(function(){function g(){l=t,c.className=i.className,e.each(u,function(e,t){c.style[t]=o.css(t)})}function y(){var e,r,u;l!==t&&g();if(!p){p=!0,c.value=t.value+i.append,c.style.overflowY=t.style.overflowY,u=parseInt(t.style.height,10),c.style.width=Math.max(o.width(),0)+"px",s?e=c.scrollHeight:(c.scrollTop=0,c.scrollTop=9e4,e=c.scrollTop);var a=parseInt(o.css("maxHeight"),10);a=a&&a>0?a:9e4,e>a?(e=a,r="scroll"):e<h&&(e=h),e+=v,t.style.overflowY=r||n,u!==e&&(t.style.height=e+"px",m&&i.callback.call(t,t)),setTimeout(function(){p=!1},1)}}var t=this,o=e(t),h,p,d,v=0,m=e.isFunction(i.callback);if(o.data("autosize"))return;if(o.css("box-sizing")===r||o.css("-moz-box-sizing")===r||o.css("-webkit-box-sizing")===r)v=o.outerHeight()-o.height();h=Math.max(parseInt(o.css("minHeight"),10)-v,o.height()),d=o.css("resize")==="none"||o.css("resize")==="vertical"?"none":"horizontal",o.css({overflow:n,overflowY:n,wordWrap:"break-word",resize:d}).data("autosize",!0),f in t?a in t?t[a]=t.onkeyup=y:t[f]=y:t[a]=y,e(window).on("resize",function(){p=!1,y()}),o.on("autosize",function(){p=!1,y()}),y()})}})(window.jQuery||window.Zepto),function(){function t(t){this.tokens=[],this.tokens.links={},this.options=t||f.defaults,this.rules=e.normal,this.options.gfm&&(this.options.tables?this.rules=e.tables:this.rules=e.gfm)}function r(e,t){this.options=t||f.defaults,this.links=e,this.rules=n.normal;if(!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=n.breaks:this.rules=n.gfm:this.options.pedantic&&(this.rules=n.pedantic)}function i(e){this.tokens=[],this.token=null,this.options=e||f.defaults}function s(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(e,t){return e=e.source,t=t||"",function n(r,i){return r?(i=i.source||i,i=i.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(r,i),n):new RegExp(e,t)}}function u(){}function a(e){var t=1,n,r;for(;t<arguments.length;t++){n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}function f(e,n,r){if(r||typeof n=="function"){r||(r=n,n=null),n&&(n=a({},f.defaults,n));var o=n.highlight,u,l,c=0;try{u=t.lex(e,n)}catch(h){return r(h)}l=u.length;var p=function(e){var t,s;e!==!0&&delete n.highlight;try{t=i.parse(u,n)}catch(a){s=a}return n.highlight=o,s?r(s):r(null,t)};if(!o||o.length<3)return p(!0);if(!l)return p();for(;c<u.length;c++)(function(e){return e.type!=="code"?--l||p():o(e.text,e.lang,function(t,n){if(n==null||n===e.text)return--l||p();e.text=n,e.escaped=!0,--l||p()})})(u[c]);return}try{return n&&(n=a({},f.defaults,n)),i.parse(t.lex(e,n),n)}catch(h){h.message+="\nPlease report this to https://github.com/chjj/marked.";if((n||f.defaults).silent)return"<p>An error occured:</p><pre>"+s(h.message+"",!0)+"</pre>";throw h}}var e={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:u,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:u,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:u,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};e.bullet=/(?:[*+-]|\d+\.)/,e.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,e.item=o(e.item,"gm")(/bull/g,e.bullet)(),e.list=o(e.list)(/bull/g,e.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),e._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",e.html=o(e.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,e._tag)(),e.paragraph=o(e.paragraph)("hr",e.hr)("heading",e.heading)("lheading",e.lheading)("blockquote",e.blockquote)("tag","<"+e._tag)("def",e.def)(),e.normal=a({},e),e.gfm=a({},e.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),e.gfm.paragraph=o(e.paragraph)("(?!","(?!"+e.gfm.fences.source.replace("\\1","\\2")+"|")(),e.tables=a({},e.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),t.rules=e,t.lex=function(e,n){var r=new t(n);return r.lex(e)},t.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},t.prototype.token=function(t,n){var t=t.replace(/^ +$/gm,""),r,i,s,o,u,a,f,l,c;while(t){if(s=this.rules.newline.exec(t))t=t.substring(s[0].length),s[0].length>1&&this.tokens.push({type:"space"});if(s=this.rules.code.exec(t)){t=t.substring(s[0].length),s=s[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?s:s.replace(/\n+$/,"")});continue}if(s=this.rules.fences.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:"code",lang:s[2],text:s[3]});continue}if(s=this.rules.heading.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:"heading",depth:s[1].length,text:s[2]});continue}if(n&&(s=this.rules.nptable.exec(t))){t=t.substring(s[0].length),a={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/\n$/,"").split("\n")};for(l=0;l<a.align.length;l++)/^ *-+: *$/.test(a.align[l])?a.align[l]="right":/^ *:-+: *$/.test(a.align[l])?a.align[l]="center":/^ *:-+ *$/.test(a.align[l])?a.align[l]="left":a.align[l]=null;for(l=0;l<a.cells.length;l++)a.cells[l]=a.cells[l].split(/ *\| */);this.tokens.push(a);continue}if(s=this.rules.lheading.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:"heading",depth:s[2]==="="?1:2,text:s[1]});continue}if(s=this.rules.hr.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:"hr"});continue}if(s=this.rules.blockquote.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:"blockquote_start"}),s=s[0].replace(/^ *> ?/gm,""),this.token(s,n),this.tokens.push({type:"blockquote_end"});continue}if(s=this.rules.list.exec(t)){t=t.substring(s[0].length),o=s[2],this.tokens.push({type:"list_start",ordered:o.length>1}),s=s[0].match(this.rules.item),r=!1,c=s.length,l=0;for(;l<c;l++)a=s[l],f=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(f-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+f+"}","gm"),"")),this.options.smartLists&&l!==c-1&&(u=e.bullet.exec(s[l+1])[0],o!==u&&!(o.length>1&&u.length>1)&&(t=s.slice(l+1).join("\n")+t,l=c-1)),i=r||/\n\n(?!\s*$)/.test(a),l!==c-1&&(r=a[a.length-1]==="\n",i||(i=r)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(a,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"});continue}if(s=this.rules.html.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:s[1]==="pre"||s[1]==="script",text:s[0]});continue}if(n&&(s=this.rules.def.exec(t))){t=t.substring(s[0].length),this.tokens.links[s[1].toLowerCase()]={href:s[2],title:s[3]};continue}if(n&&(s=this.rules.table.exec(t))){t=t.substring(s[0].length),a={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(l=0;l<a.align.length;l++)/^ *-+: *$/.test(a.align[l])?a.align[l]="right":/^ *:-+: *$/.test(a.align[l])?a.align[l]="center":/^ *:-+ *$/.test(a.align[l])?a.align[l]="left":a.align[l]=null;for(l=0;l<a.cells.length;l++)a.cells[l]=a.cells[l].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(a);continue}if(n&&(s=this.rules.paragraph.exec(t))){t=t.substring(s[0].length),this.tokens.push({type:"paragraph",text:s[1][s[1].length-1]==="\n"?s[1].slice(0,-1):s[1]});continue}if(s=this.rules.text.exec(t)){t=t.substring(s[0].length),this.tokens.push({type:"text",text:s[0]});continue}if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0))}return this.tokens};var n={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:u,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:u,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};n._inside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,n._href=/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,n.link=o(n.link)("inside",n._inside)("href",n._href)(),n.reflink=o(n.reflink)("inside",n._inside)(),n.normal=a({},n),n.pedantic=a({},n.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),n.gfm=a({},n.normal,{escape:o(n.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:o(n.text)("]|","~]|")("|","|https?://|")()}),n.breaks=a({},n.gfm,{br:o(n.br)("{2,}","*")(),text:o(n.gfm.text)("{2,}","*")()}),r.rules=n,r.output=function(e,t,n){var i=new r(t,n);return i.output(e)},r.prototype.output=function(e){var t="",n,r,i,o;while(e){if(o=this.rules.escape.exec(e)){e=e.substring(o[0].length),t+=o[1];continue}if(o=this.rules.autolink.exec(e)){e=e.substring(o[0].length),o[2]==="@"?(r=o[1][6]===":"?this.mangle(o[1].substring(7)):this.mangle(o[1]),i=this.mangle("mailto:")+r):(r=s(o[1]),i=r),t+='<a href="'+i+'">'+r+"</a>";continue}if(o=this.rules.url.exec(e)){e=e.substring(o[0].length),r=s(o[1]),i=r,t+='<a href="'+i+'">'+r+"</a>";continue}if(o=this.rules.tag.exec(e)){e=e.substring(o[0].length),t+=this.options.sanitize?s(o[0]):o[0];continue}if(o=this.rules.link.exec(e)){e=e.substring(o[0].length),t+=this.outputLink(o,{href:o[2],title:o[3]});continue}if((o=this.rules.reflink.exec(e))||(o=this.rules.nolink.exec(e))){e=e.substring(o[0].length),n=(o[2]||o[1]).replace(/\s+/g," "),n=this.links[n.toLowerCase()];if(!n||!n.href){t+=o[0][0],e=o[0].substring(1)+e;continue}t+=this.outputLink(o,n);continue}if(o=this.rules.strong.exec(e)){e=e.substring(o[0].length),t+="<strong>"+this.output(o[2]||o[1])+"</strong>";continue}if(o=this.rules.em.exec(e)){e=e.substring(o[0].length),t+="<em>"+this.output(o[2]||o[1])+"</em>";continue}if(o=this.rules.code.exec(e)){e=e.substring(o[0].length),t+="<code>"+s(o[2],!0)+"</code>";continue}if(o=this.rules.br.exec(e)){e=e.substring(o[0].length),t+="<br>";continue}if(o=this.rules.del.exec(e)){e=e.substring(o[0].length),t+="<del>"+this.output(o[1])+"</del>";continue}if(o=this.rules.text.exec(e)){e=e.substring(o[0].length),t+=s(this.smartypants(o[0]));continue}if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}return t},r.prototype.outputLink=function(e,t){return e[0][0]!=="!"?'<a href="'+s(t.href)+'"'+(t.title?' title="'+s(t.title)+'"':"")+">"+this.output(e[1])+"</a>":'<img src="'+s(t.href)+'" alt="'+s(e[1])+'"'+(t.title?' title="'+s(t.title)+'"':"")+">"},r.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/'([^']*)'/g,"‘$1’").replace(/"([^"]*)"/g,"“$1”").replace(/\.{3}/g,"…"):e},r.prototype.mangle=function(e){var t="",n=e.length,r=0,i;for(;r<n;r++)i=e.charCodeAt(r),Math.random()>.5&&(i="x"+i.toString(16)),t+="&#"+i+";";return t},i.parse=function(e,t){var n=new i(t);return n.parse(e)},i.prototype.parse=function(e){this.inline=new r(e.links,this.options),this.tokens=e.reverse();var t="";while(this.next())t+=this.tok();return t},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){var e=this.token.text;while(this.peek().type==="text")e+="\n"+this.next().text;return this.inline.output(e)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var e=this.options.highlight(this.token.text,this.token.lang);e!=null&&e!==this.token.text&&(this.token.escaped=!0,this.token.text=e)}return this.token.escaped||(this.token.text=s(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"table":var t="",n,r,i,o,u;t+="<thead>\n<tr>\n";for(r=0;r<this.token.header.length;r++)n=this.inline.output(this.token.header[r]),t+=this.token.align[r]?'<th align="'+this.token.align[r]+'">'+n+"</th>\n":"<th>"+n+"</th>\n";t+="</tr>\n</thead>\n",t+="<tbody>\n";for(r=0;r<this.token.cells.length;r++){i=this.token.cells[r],t+="<tr>\n";for(u=0;u<i.length;u++)o=this.inline.output(i[u]),t+=this.token.align[u]?'<td align="'+this.token.align[u]+'">'+o+"</td>\n":"<td>"+o+"</td>\n";t+="</tr>\n"}return t+="</tbody>\n","<table>\n"+t+"</table>\n";case"blockquote_start":var t="";while(this.next().type!=="blockquote_end")t+=this.tok();return"<blockquote>\n"+t+"</blockquote>\n";case"list_start":var a=this.token.ordered?"ol":"ul",t="";while(this.next().type!=="list_end")t+=this.tok();return"<"+a+">\n"+t+"</"+a+">\n";case"list_item_start":var t="";while(this.next().type!=="list_item_end")t+=this.token.type==="text"?this.parseText():this.tok();return"<li>"+t+"</li>\n";case"loose_item_start":var t="";while(this.next().type!=="list_item_end")t+=this.tok();return"<li>"+t+"</li>\n";case"html":return!this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text;case"paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}},u.exec=u,f.options=f.setOptions=function(e){return a(f.defaults,e),f},f.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1},f.Parser=i,f.parser=i.parse,f.Lexer=t,f.lexer=t.lex,f.InlineLexer=r,f.inlineLexer=r.output,f.parse=f,typeof exports=="object"?module.exports=f:typeof define=="function"&&define.amd?define(function(){return f}):this.marked=f}.call(function(){return this||(typeof window!="undefined"?window:global)}());var e="#rawHtml",t="#previewContainer",n="#drafts",r=$(t),s=$("#editArea"),o=$(n),u=$("#editContainer"),a=$("#previewPane"),f=$("#drafts"),l=$("#title"),c=$("#saveStatus"),h=$(e),p=$("#plain"),d=$("#createNew"),v=$("#renderSavedDrafts"),m=$("#wordCount"),g=$("#secret"),y=$("#update"),b=$("#tags");(function(e){var t=new Array,n=new Array;e.fn.doAutosize=function(t){var n=e(this).data("minwidth"),r=e(this).data("maxwidth"),i="",s=e(this),o=e("#"+e(this).data("tester_id"));if(i===(i=s.val()))return;var u=i.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");o.html(u);var a=o.width(),f=a+t.comfortZone>=n?a+t.comfortZone:n,l=s.width(),c=f<l&&f>=n||f>n&&f<r;c&&s.width(f)},e.fn.resetAutosize=function(t){var n=e(this).data("minwidth")||t.minInputWidth||e(this).width(),r=e(this).data("maxwidth")||t.maxInputWidth||e(this).closest(".tagsinput").width()-t.inputPadding,i="",s=e(this),o=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:s.css("fontSize"),fontFamily:s.css("fontFamily"),fontWeight:s.css("fontWeight"),letterSpacing:s.css("letterSpacing"),whiteSpace:"nowrap"}),u=e(this).attr("id")+"_autosize_tester";!e("#"+u).length>0&&(o.attr("id",u),o.appendTo("body")),s.data("minwidth",n),s.data("maxwidth",r),s.data("tester_id",u),s.css("width",n)},e.fn.addTag=function(r,i){return i=jQuery.extend({focus:!1,callback:!0},i),this.each(function(){var s=e(this).attr("id"),o=e(this).val().split(t[s]);o[0]==""&&(o=new Array),r=jQuery.trim(r);if(i.unique){var u=e(this).tagExist(r);u==1&&e("#"+s+"_tag").addClass("not_valid")}else var u=!1;if(r!=""&&u!=1){e("<span>").addClass("tag").append(e("<span>").text(r).append("&nbsp;&nbsp;"),e("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return e("#"+s).removeTag(escape(r))})).insertBefore("#"+s+"_addTag"),o.push(r),e("#"+s+"_tag").val(""),i.focus?e("#"+s+"_tag").focus():e("#"+s+"_tag").blur(),e.fn.tagsInput.updateTagsField(this,o);if(i.callback&&n[s]&&n[s].onAddTag){var a=n[s].onAddTag;a.call(this,r)}if(n[s]&&n[s].onChange){var f=o.length,a=n[s].onChange;a.call(this,e(this),o[f-1])}}}),!1},e.fn.removeTag=function(r){return r=unescape(r),this.each(function(){var s=e(this).attr("id"),o=e(this).val().split(t[s]);e("#"+s+"_tagsinput .tag").remove(),str="";for(i=0;i<o.length;i++)o[i]!=r&&(str=str+t[s]+o[i]);e.fn.tagsInput.importTags(this,str);if(n[s]&&n[s].onRemoveTag){var u=n[s].onRemoveTag;u.call(this,r)}}),!1},e.fn.tagExist=function(n){var r=e(this).attr("id"),i=e(this).val().split(t[r]);return jQuery.inArray(n,i)>=0},e.fn.importTags=function(t){id=e(this).attr("id"),e("#"+id+"_tagsinput .tag").remove(),e.fn.tagsInput.importTags(this,t)},e.fn.tagsInput=function(r){var i=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},r);return this.each(function(){i.hide&&e(this).hide();var r=e(this).attr("id");if(!r||t[e(this).attr("id")])r=e(this).attr("id","tags"+(new Date).getTime()).attr("id");var s=jQuery.extend({pid:r,real_input:"#"+r,holder:"#"+r+"_tagsinput",input_wrapper:"#"+r+"_addTag",fake_input:"#"+r+"_tag"},i);t[r]=s.delimiter;if(i.onAddTag||i.onRemoveTag||i.onChange)n[r]=new Array,n[r].onAddTag=i.onAddTag,n[r].onRemoveTag=i.onRemoveTag,n[r].onChange=i.onChange;var o='<div id="'+r+'_tagsinput" class="tagsinput"><div id="'+r+'_addTag">';i.interactive&&(o=o+'<input id="'+r+'_tag" value="" data-default="'+i.defaultText+'" />'),o+='</div><div class="tags_clear"></div></div>',e(o).insertAfter(this),e(s.holder).css("width",i.width),e(s.holder).css("min-height",i.height),e(s.holder).css("height","100%"),e(s.real_input).val()!=""&&e.fn.tagsInput.importTags(e(s.real_input),e(s.real_input).val());if(i.interactive){e(s.fake_input).val(e(s.fake_input).attr("data-default")),e(s.fake_input).css("color",i.placeholderColor),e(s.fake_input).resetAutosize(i),e(s.holder).bind("click",s,function(t){e(t.data.fake_input).focus()}),e(s.fake_input).bind("focus",s,function(t){e(t.data.fake_input).val()==e(t.data.fake_input).attr("data-default")&&e(t.data.fake_input).val(""),e(t.data.fake_input).css("color","#000000")});if(i.autocomplete_url!=undefined){autocomplete_options={source:i.autocomplete_url};for(attrname in i.autocomplete)autocomplete_options[attrname]=i.autocomplete[attrname];jQuery.Autocompleter!==undefined?(e(s.fake_input).autocomplete(i.autocomplete_url,i.autocomplete),e(s.fake_input).bind("result",s,function(t,n,s){n&&e("#"+r).addTag(n[0]+"",{focus:!0,unique:i.unique})})):jQuery.ui.autocomplete!==undefined&&(e(s.fake_input).autocomplete(autocomplete_options),e(s.fake_input).bind("autocompleteselect",s,function(t,n){return e(t.data.real_input).addTag(n.item.value,{focus:!0,unique:i.unique}),!1}))}else e(s.fake_input).bind("blur",s,function(t){var n=e(this).attr("data-default");return e(t.data.fake_input).val()!=""&&e(t.data.fake_input).val()!=n?t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=e(t.data.fake_input).val().length)&&e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:i.unique}):(e(t.data.fake_input).val(e(t.data.fake_input).attr("data-default")),e(t.data.fake_input).css("color",i.placeholderColor)),!1});e(s.fake_input).bind("keypress",s,function(t){if(t.which==t.data.delimiter.charCodeAt(0)||t.which==13)return t.preventDefault(),t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=e(t.data.fake_input).val().length)&&e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:i.unique}),e(t.data.fake_input).resetAutosize(i),!1;t.data.autosize&&e(t.data.fake_input).doAutosize(i)}),s.removeWithBackspace&&e(s.fake_input).bind("keydown",function(t){if(t.keyCode==8&&e(this).val()==""){t.preventDefault();var n=e(this).closest(".tagsinput").find(".tag:last").text(),r=e(this).attr("id").replace(/_tag$/,"");n=n.replace(/[\s]+x$/,""),e("#"+r).removeTag(escape(n)),e(this).trigger("focus")}}),e(s.fake_input).blur(),s.unique&&e(s.fake_input).keydown(function(t){(t.keyCode==8||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&e(this).removeClass("not_valid")})}}),this},e.fn.tagsInput.updateTagsField=function(n,r){var i=e(n).attr("id");e(n).val(r.join(t[i]))},e.fn.tagsInput.importTags=function(r,s){e(r).val("");var o=e(r).attr("id"),u=s.split(t[o]);for(i=0;i<u.length;i++)e(r).addTag(u[i],{focus:!1,callback:!1});if(n[o]&&n[o].onChange){var a=n[o].onChange;a.call(r,r,u[i])}}})(jQuery);var w=function(e,t){var n=this,r=e.wordCount;n.date=(new Date(e.time)).toDateString(),n.count=r,n.title=t,n.plural=r>1,n.trueDate=new Date(e.time)},E=function(i){var s=this;s.drafts=ko.observableArray(i),s.showEditor=ko.observable(!0),s.showTitle=ko.observable(!0),s.raw=ko.observable(!0),s.secret=ko.observable(),s.currentKey="",s.deleteDraft=function(e,t){t.stopPropagation(),z(e.title),s.drafts.remove(e)},s.showDrafts=function(){s.showEditor(!1),s.showTitle(!1),q(),r.hide(),$("#tags_tagsinput").hide(),o.show()},s.newDraft=function(){T([t,n]),s.showTitle(!0),s.showEditor(!0),B.focus(),B.val(""),l.val(""),$("#tags_tagsinput").show()},s.showPreview=function(){_()&&(L(C()),p.hide(),s.showEditor(!1),s.showTitle(!0),N([e,t]),s.saveAndNotify(),$("#tags_tagsinput").show(),$("#tags_tagsinput").on("click",function(e){e.stopPropagation()}))},s.hidePreview=function(){r.hide(),s.showEditor(!0),B.trigger("autosize"),B.focus(),$("#tags_tagsinput").hide()},s.editDraft=function(e){var t=e.title,n=U(t),r=JSON.parse(n);o.hide(),B.val(r.text).trigger("autosize"),l.val(t),s.currentKey=t,m.text(r.wordCount),s.showEditor(!0),s.showTitle(!0),$("#tags").importTags(r.tags),$("#tags_tagsinput").hide()},s.rawHtml=function(e,t){A(),t.stopPropagation(),s.raw(!1)},s.plain=function(e,t){O(),t.stopPropagation(),s.raw(!0)},s.editingSecret=function(e,t){t.stopPropagation()},s.hasProvidedSecret=ko.computed(function(){return s.secret()?!0:!1}),s.publishArticle=function(e,t){t.stopPropagation(),P()},s.updateArticle=function(e,t){t.stopPropagation(),H()},s.saveAndNotify=function(){R(s.currentKey),c.fadeIn().show().delay(1e3).fadeOut()},s.editTitle=function(){s.currentKey=l.val(),r.hide(),s.showEditor(!0),$("#tags_tagsinput").show()}},S=new E;ko.applyBindings(S);var B=x();reMarked=function(e){function r(e,t){if(!t)return e;for(var n in e)typeof t[n]!="undefined"&&(e[n]=t[n])}function i(e,t){var n="";while(t-->0)n+=e;return n}function s(e){var e=e.replace(/^\s\s*/,""),t=/\s/,n=e.length;while(t.test(e.charAt(--n)));return e.slice(0,n+1)}function o(e,t,n){return i(t,n-e.length)+e}function u(e,t,n){return e+i(t,n-e.length)}function a(e){return e?"<"+e+">":""}function f(e){return e?"</"+e+">":""}function l(e,t){return e.replace(/^/gm,t)}function c(e){return(e.nodeName=="#text"?"txt":e.nodeName).toLowerCase()}function h(e,t){var n,r;return t instanceof Array?(n=t[0],r=t[1]):n=r=t,n=n instanceof Function?n.call(this,e):n,r=r instanceof Function?r.call(this,e):r,n+e+r}var t=[],n={link_list:!1,h1_setext:!0,h2_setext:!0,h_atx_suf:!1,gfm_code:!1,li_bullet:"*-+"[0],hr_char:"-_*"[0],indnt_str:["    ","	","  "][0],bold_char:"*_"[0],emph_char:"*_"[1],gfm_del:!0,gfm_tbls:!0,tbl_edges:!1,hash_lnks:!1,br_only:!1};r(n,e),this.render=function(e){if(typeof e=="string"){var r=e;e=document.createElement("div"),e.innerHTML=r}var s=new p.tag(e,null,0),o=s.rend().replace(/^[\t ]+\n/gm,"\n");if(n.link_list){o+="\n\n";var u=0;for(var a in t){if(!t[a].e.title)continue;var f=t[a].e.href.length;f&&f>u&&(u=f)}for(var l in t){var c=t[l].e.title?i(" ",u+2-t[l].e.href.length)+'"'+t[l].e.title+'"':"";o+="  ["+(+l+1)+"]: "+t[l].e.href+c+"\n"}}return o.replace(/^[\t ]+\n/gm,"\n")};var p={};p.tag=klass({wrap:"",lnPfx:"",lnInd:0,init:function(e,t,n){this.e=e,this.p=t,this.i=n,this.c=[],this.tag=c(e),this.initK()},initK:function(){var e;if(this.e.hasChildNodes()){var n=/^(?:a|strong|code|em|sub|sup|del|i|u|b|big|center)$/,r,i;for(e in this.e.childNodes){if(!/\d+/.test(e))continue;r=this.e.childNodes[e],i=c(r);if(/style|script|canvas|video|audio/.test(i))continue;if(i=="txt"&&/^\s+$/.test(r.textContent)){if(e==0||e==this.e.childNodes.length-1)continue;var s=this.e.childNodes[e-1],o=this.e.childNodes[e+1];if(s&&!c(s).match(n)||o&&!c(o).match(n))continue}p[i]||(i="tag");var u=new p[i](r,this,this.c.length);if(u instanceof p.a&&r.href||u instanceof p.img)u.lnkid=t.length,t.push(u);this.c.push(u)}}},rend:function(){return this.rendK().replace(/\n{3,}/gm,"\n\n")},rendK:function(){var e,t="";for(var n in this.c)e=this.c[n],t+=(e.bef||"")+e.rend()+(e.aft||"");return t.replace(/^\n+|\n+$/,"")}}),p.blk=p.tag.extend({wrap:["\n\n",""],wrapK:null,tagr:!1,lnInd:null,init:function(e,t,n){this.supr(e,t,n),this.lnInd===null&&(this.p&&this.tagr&&this.c[0]instanceof p.blk?this.lnInd=4:this.lnInd=0),this.wrapK===null&&(this.tagr&&this.c[0]instanceof p.blk?this.wrapK="\n":this.wrapK="")},rend:function(){return h.call(this,(this.tagr?a(this.tag):"")+h.call(this,l(l(this.rendK(),this.lnPfx),i(" ",this.lnInd)),this.wrapK)+(this.tagr?f(this.tag):""),this.wrap)},rendK:function(){var e=this.supr();if(this.p instanceof p.li){var t=null,n=e.match(/^[\t ]+/gm);if(!n)return e;for(var r in n)if(t===null||n[r][0].length<t.length)t=n[r][0];return e.replace(new RegExp("^"+t),"")}return e}}),p.tblk=p.blk.extend({tagr:!0}),p.cblk=p.blk.extend({wrap:["\n",""]}),p.ctblk=p.cblk.extend({tagr:!0}),p.inl=p.tag.extend({rend:function(){return h.call(this,this.rendK(),this.wrap)}}),p.tinl=p.inl.extend({tagr:!0,rend:function(){return a(this.tag)+h.call(this,this.rendK(),this.wrap)+f(this.tag)}}),p.p=p.blk.extend({rendK:function(){return this.supr().replace(/^\s+/gm,"")}}),p.div=p.p.extend(),p.span=p.inl.extend(),p.list=p.blk.extend({expn:!1,wrap:[function(){return this.p instanceof p.li?"\n":"\n\n"},""]}),p.ul=p.list.extend({}),p.ol=p.list.extend({}),p.li=p.cblk.extend({wrap:["\n",function(e){return this.p.expn||e.match(/\n{2}/gm)?"\n":""}],wrapK:[function(){return this.p.tag=="ul"?n.li_bullet+" ":this.i+1+".  "},""],rendK:function(){return this.supr().replace(/\n([^\n])/gm,"\n"+n.indnt_str+"$1")}}),p.hr=p.blk.extend({wrap:["\n\n",i(n.hr_char,3)]}),p.h=p.blk.extend({}),p.h_setext=p.h.extend({}),n.h1_setext&&(p.h1=p.h_setext.extend({wrapK:["",function(e){return"\n"+i("=",e.length)}]})),n.h2_setext&&(p.h2=p.h_setext.extend({wrapK:["",function(e){return"\n"+i("-",e.length)}]})),p.h_atx=p.h.extend({wrapK:[function(e){return i("#",this.tag[1])+" "},function(e){return n.h_atx_suf?" "+i("#",this.tag[1]):""}]}),!n.h1_setext&&(p.h1=p.h_atx.extend({})),!n.h2_setext&&(p.h2=p.h_atx.extend({})),p.h3=p.h_atx.extend({}),p.h4=p.h_atx.extend({}),p.h5=p.h_atx.extend({}),p.h6=p.h_atx.extend({}),p.a=p.inl.extend({lnkid:null,rend:function(){var e=this.rendK(),t=this.e.getAttribute("href"),r=this.e.title?' "'+this.e.title+'"':"";return!t||t==e||t[0]=="#"&&!n.hash_lnks?e:n.link_list?"["+e+"] ["+(this.lnkid+1)+"]":"["+e+"]("+t+r+")"}}),p.img=p.inl.extend({lnkid:null,rend:function(){var e=this.e.alt,t=this.e.getAttribute("src");if(n.link_list)return"["+e+"] ["+(this.lnkid+1)+"]";var r=this.e.title?' "'+this.e.title+'"':"";return"!["+e+"]("+t+r+")"}}),p.em=p.inl.extend({wrap:n.emph_char}),p.i=p.em.extend(),p.del=n.gfm_del?p.inl.extend({wrap:"~~"}):p.tinl.extend(),p.br=p.inl.extend({wrap:["",function(){var e=n.br_only?"<br>":"  ";return this.p instanceof p.h?"<br>":e+"\n"}]}),p.strong=p.inl.extend({wrap:i(n.bold_char,2)}),p.b=p.strong.extend(),p.dl=p.tblk.extend({lnInd:2}),p.dt=p.ctblk.extend(),p.dd=p.ctblk.extend(),p.sub=p.tinl.extend(),p.sup=p.tinl.extend(),p.blockquote=p.blk.extend({lnPfx:"> ",rend:function(){return this.supr().replace(/>[ \t]$/gm,">")}}),p.pre=p.blk.extend({tagr:!0,wrapK:"\n",lnInd:0}),p.code=p.blk.extend({tagr:!1,wrap:"",wrapK:function(e){return e.indexOf("`")!==-1?"``":"`"},lnInd:0,init:function(e,t,r){this.supr(e,t,r);if(this.p instanceof p.pre){this.p.tagr=!1;if(n.gfm_code){var i=this.e.getAttribute("class");i=(i||"").split(" ")[0],i.indexOf("lang-")===0&&(i=i.substr(5)),this.wrapK=["```"+i+"\n","\n```"]}else this.wrapK="",this.p.lnInd=4}}}),p.table=n.gfm_tbls?p.blk.extend({cols:[],init:function(e,t,n){this.supr(e,t,n),this.cols=[]},rend:function(){for(var e in this.c)for(var t in this.c[e].c)for(var n in this.c[e].c[t].c)this.c[e].c[t].c[n].prep();return this.supr()}}):p.tblk.extend(),p.thead=n.gfm_tbls?p.cblk.extend({wrap:["\n",function(e){var t="";for(var r in this.p.cols){var o=this.p.cols[r],u=o.a[0]=="c"?":":" ",a=o.a[0]=="r"||o.a[0]=="c"?":":" ";t+=(r==0&&n.tbl_edges?"|":"")+u+i("-",o.w)+a+(r<this.p.cols.length-1||n.tbl_edges?"|":"")}return"\n"+s(t)}]}):p.ctblk.extend(),p.tbody=n.gfm_tbls?p.cblk.extend():p.ctblk.extend(),p.tfoot=n.gfm_tbls?p.cblk.extend():p.ctblk.extend(),p.tr=n.gfm_tbls?p.cblk.extend({wrapK:[n.tbl_edges?"| ":"",n.tbl_edges?" |":""]}):p.ctblk.extend(),p.th=n.gfm_tbls?p.inl.extend({guts:null,wrap:[function(){var e=this.p.p.p.cols[this.i],t=this.i==0?"":" ",n,r=e.w-this.guts.length;switch(e.a[0]){case"r":n=i(" ",r);break;case"c":n=i(" ",Math.floor(r/2));break;default:n=""}return t+n},function(){var e=this.p.p.p.cols[this.i],t=this.i==this.p.c.length-1?"":" |",n,r=e.w-this.guts.length;switch(e.a[0]){case"r":n="";break;case"c":n=i(" ",Math.ceil(r/2));break;default:n=i(" ",r)}return n+t}],prep:function(){this.guts=this.rendK(),this.rendK=function(){return this.guts};var e=this.p.p.p.cols;e[this.i]||(e[this.i]={w:null,a:""});var t=e[this.i];t.w=Math.max(t.w||0,this.guts.length),this.e.align&&(t.a=this.e.align)}}):p.ctblk.extend(),p.td=p.th.extend(),p.txt=p.inl.extend({initK:function(){this.c=this.e.textContent.split(/^/gm)},rendK:function(){var e=this.c.join("").replace(/\r/gm,"");return this.p instanceof p.code||this.p instanceof p.pre||(e=e.replace(/^\s*#/gm,"\\#").replace(/\*/gm,"\\*")),this.i==0&&(e=e.replace(/^\n+/,"")),this.i==this.p.c.length-1&&(e=e.replace(/\n+$/,"")),e}})},!function(e,t){typeof define=="function"?define(t):typeof module!="undefined"?module.exports=t():this[e]=t()}("klass",function(){function e(e){return i.call(t(e)?e:function(){},e,1)}function t(e){return typeof e===u}function n(e,t,n){return function(){var r=this.supr;this.supr=n[f][e];var i=t.apply(this,arguments);return this.supr=r,i}}function r(e,r,i){for(var s in r)r.hasOwnProperty(s)&&(e[s]=t(r[s])&&t(i[f][s])&&a.test(r[s])?n(s,r[s],i):r[s])}function i(e,n){function i(){}function s(){this.init?this.init.apply(this,arguments):(n||a&&o.apply(this,arguments),l.apply(this,arguments))}i[f]=this[f];var o=this,u=new i,a=t(e),l=a?e:this,c=a?{}:e;return s.methods=function(e){return r(u,e,o),s[f]=u,this},s.methods.call(s,c).prototype.constructor=s,s.extend=arguments.callee,s[f].implement=s.statics=function(e,t){return e=typeof e=="string"?function(){var n={};return n[e]=t,n}():e,r(this,e,o),this},s}var s=this,o=s.klass,u="function",a=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,f="prototype";return e.noConflict=function(){return s.klass=o,this},s.klass=e,e})})